"use strict";(self.webpackChunkmah=self.webpackChunkmah||[]).push([[47],{378:(w,q,p)=>{p.d(q,{K:()=>m});var n=p(50);class m{static random(f){return Math.floor(Math.random()*f.length)}static randomExtract(f){const u=m.random(f);return f.splice(u,1)[0]}static collectNodes(f,u){const o={left:[],right:[],top:[],bottom:[]};let e;for(let s=u.y-1;s<=u.y+1;s++){e=(0,n.D)(f,u.z,u.x-2,s),e&&o.left.push(e),e=(0,n.D)(f,u.z,u.x+2,s),e&&o.right.push(e);for(let i=u.x-1;i<=u.x+1;i++)e=(0,n.D)(f,u.z+1,i,s),e&&o.top.push(e),e=(0,n.D)(f,u.z-1,i,s),e&&o.bottom.push(e)}return o}static fillStones(f,u){const o={};return f.forEach(e=>{const s=u.list[e.v];e.img=s?s.img:{id:void 0},o[e.groupnr]=o[e.groupnr]||[],o[e.groupnr].push(e),e.nodes=m.collectNodes(f,e)}),Object.keys(o).forEach(e=>{const s=o[Number(e)];s.forEach(i=>{i.group=s.filter(r=>r!==i)})}),f}getTilesInGame(f,u){return f.list.filter(o=>void 0!==o)}getTilesInPairs(f,u){const o=[];return f.groups.forEach(e=>{for(let s=0;s<e.tiles.length;s+=2)o.push([e.tiles[s],e.tiles[s+1]])}),o}}},405:(w,q,p)=>{p.d(q,{v:()=>y});var n=p(50),m=p(378);class y extends m.K{build(u,o){const e=this.getTilesInGame(o,u.length),s=[],i=u.slice(0);for(;i.length>0;){const r=m.K.randomExtract(e),t=m.K.randomExtract(i);s.push(new n.r(t[0],t[1],t[2],r.v,r.groupnr))}return m.K.fillStones(s,o),s}}},678:(w,q,p)=>{p.d(q,{N:()=>f});var n=p(50),m=p(378),y=p(405);class f extends m.K{build(o,e){const s=[];o.forEach(t=>{s.push(new n.r(t[0],t[1],t[2],0,0))}),m.K.fillStones(s,e);let i=1,r=this.solve(s,e);for(;0===r.length&&i<1e3;)s.forEach(t=>{t.picked=!1,t.v=0,t.groupnr=0}),r=this.solve(s,e),i++;return 0===r.length?(new y.v).build(o,e):(s.forEach(t=>{t.picked=!1}),m.K.fillStones(s,e),s.sort((t,l)=>t.v-l.v),s)}solve(o,e){const s=[],i=[],r=o.length/2,t=e.groups.slice();for(;t.length>0;){const a=m.K.randomExtract(t).tiles.slice(),h=m.K.randomExtract(a),d=m.K.randomExtract(a),c=m.K.randomExtract(a),g=a[0];i.length<r&&i.push([h,d]),i.length<r&&i.push([c,g])}for(;i.length>0;){const l=m.K.randomExtract(i),a=o.filter(c=>!c.picked&&!c.isBlocked());if(a.length<2)return[];const h=m.K.randomExtract(a),d=m.K.randomExtract(a);h.v=l[0].v,h.img=l[0].img,h.groupnr=l[0].groupnr,h.picked=!0,d.v=l[1].v,d.img=l[1].img,d.groupnr=l[1].groupnr,d.picked=!0,s.push(l)}return s}}},124:(w,q,p)=>{function n(o){if(!o)return!1;let e=0,s=o.above[e];for(;void 0!==s;){if(!s.isPlayed)return!1;e++,s=o.above[e]}e=0;let i=o.left[e];for(;void 0!==i;){if(!i.isPlayed){e=0;let r=o.right[e];for(;void 0!==r;){if(!r.isPlayed)return!1;e++,r=o.right[e]}return!0}e++,i=o.left[e]}return!0}function m(){return Math.floor(100*Math.random())}p.d(q,{M:()=>u});class f{constructor(e,s,i,r,t,l,a){this.qt=s,this.lo=i,this.ngroups=r,this.maxheight=t,this.maxwidth=l,this.maxdepth=a,this.result=[],this.ntiles1=e,this.ntiles2=e}write(){do{this.ntiles1=this.ntiles2;for(let e=0;e<this.ngroups;e++)this.writeGroup(e)}while(this.ntiles2!==this.ntiles1);return this.result}writePair(e,s,i){const r=this.qt[e].member[s],t=this.qt[e].member[i];for(let l=0;l<this.maxheight;l++)for(let a=0;a<this.maxwidth;a++)for(let h=0;h<this.maxdepth;h++)(this.lo[l][a][h]===r||this.lo[l][a][h]===t)&&this.result.push([h,a,l])}writePairing(e,s,i,r){const t=s.member[i],l=s.member[r];return!!(t&&l&&!t.isPlayed&&n(t)&&n(l))&&(this.writePair(e,i,r),t.isPlayed=!0,l.isPlayed=!0,this.ntiles2-=2,!0)}writeGroup(e){const s=this.qt[e];switch(s.bestpairing){case 1:this.writePairing(e,s,0,1)&&(s.isplayed=s.member[2].isPlayed),this.writePairing(e,s,2,3);break;case 2:this.writePairing(e,s,0,2),this.writePairing(e,s,1,3);break;case 3:this.writePairing(e,s,0,3),this.writePairing(e,s,1,2);break;case 4:this.writePairing(e,s,0,1)}}}class u{constructor(){this.tl=[],this.qt=[],this.lo=[],this.qts=[],this.maxgroups=80,this.maxheight=40,this.maxwidth=100,this.maxdepth=10}solveLayout(e){for(let s=0;s<this.maxheight;s++){this.lo[s]=[];for(let i=0;i<this.maxwidth;i++){this.lo[s][i]=[];for(let r=0;r<this.maxdepth;r++)this.lo[s][i][r]=void 0}}return e.forEach(s=>{const i={left:[],right:[],above:[],below:[],value:s.groupnr,isPlayed:!1};this.lo[s.y][s.x][s.z]=i,this.tl.push(i)}),this.ntilesCount=e.length,this.solve(0,0)}writeGame(){return this.unrotateGroups(),new f(this.ntilesCount,this.qt,this.lo,this.ngroups,this.maxheight,this.maxwidth,this.maxdepth).write()}static playTile(e,s,i){let r=i;for(let t=0;void 0!==e.left[t];t++){const l=e.left[t];l.isPlayed||(s[l.value]-=n(l)?1:0)}for(let t=0;void 0!==e.right[t];t++){const l=e.right[t];l.isPlayed||(s[l.value]-=n(l)?1:0)}e.isPlayed=!0,r--;for(let t=0;void 0!==e.left[t];t++){const l=e.left[t];l.isPlayed||(s[l.value]+=n(l)?1:0)}for(let t=0;void 0!==e.right[t];t++){const l=e.right[t];l.isPlayed||(s[l.value]+=n(l)?1:0)}for(let t=0;void 0!==e.below[t];t++){const l=e.below[t];s[l.value]+=n(l)?1:0}return r}initSolve(){this.tl.forEach(i=>{i.left[0]=void 0,i.left[1]=void 0,i.left[2]=void 0,i.right[0]=void 0,i.right[1]=void 0,i.right[2]=void 0,i.above[0]=void 0,i.above[1]=void 0,i.above[2]=void 0,i.above[3]=void 0,i.above[4]=void 0,i.below[0]=void 0,i.below[1]=void 0,i.below[2]=void 0,i.below[3]=void 0,i.below[4]=void 0,i.isPlayed=!1});for(let i=0;i<this.maxheight;i++)for(let r=2;r<this.maxwidth;r++)for(let t=0;t<this.maxdepth;t++){const l=this.lo[i][r][t];if(void 0!==l){let h=0;for(let d=Math.max(i-1,0);d<Math.min(i+2,this.maxheight);d++)void 0!==this.lo[d][r-2][t]&&(l.left[h]=this.lo[d][r-2][t],h++)}const a=this.lo[i][r-2][t];if(void 0!==a){let h=0;for(let d=Math.max(i-1,0);d<Math.min(i+2,this.maxheight);d++)void 0!==this.lo[d][r][t]&&(a.right[h]=this.lo[d][r][t],h++)}}for(let i=0;i<this.maxheight;i++)for(let r=0;r<this.maxwidth;r++)for(let t=1;t<this.maxdepth;t++){const l=this.lo[i][r][t-1];if(void 0!==l){let h=0;for(let d=Math.max(i-1,0);d<Math.min(i+2,this.maxheight);d++)for(let c=Math.max(r-1,0);c<Math.min(r+2,this.maxwidth);c++)void 0!==this.lo[d][c][t]&&(l.above[h]=this.lo[d][c][t],h++)}const a=this.lo[i][r][t];if(void 0!==a){let h=0;for(let d=Math.max(i-1,0);d<Math.min(i+2,this.maxheight);d++)for(let c=Math.max(r-1,0);c<Math.min(r+2,this.maxwidth);c++)void 0!==this.lo[d][c][t-1]&&(a.below[h]=this.lo[d][c][t-1],h++)}}this.qt=[];for(let i=0;i<this.maxgroups;i++)this.qt.push({pairing:-1,bestpairing:-1,nmembers:0,member:[],isplayed:!1,rotation:0});for(let i=0;i<this.ntilesCount;i++){const r=this.tl[i].value;this.qt[r].member[this.qt[r].nmembers]=this.tl[i],this.qt[r].nmembers++}let e=0,s=0;for(let i=0;i<this.maxgroups;i++){const r=this.qt[i];2===r.nmembers&&(this.qts[e]=r,this.qts[e].pairing=4,e++),0!==r.nmembers&&(s=i)}for(let i=0;i<=s;i++){const r=this.qt[i];0===r.nmembers&&(this.qts[e]=r,this.qts[e].pairing=-1,e++)}this.qtsindex=e;for(let i=0;i<=s;i++){const r=this.qt[i];if(4===r.nmembers){this.qts[e]=r,this.qts[e].pairing=0;const t=this.qts[e],l=m()%(e+1-this.qtsindex);this.qts[e]=this.qts[this.qtsindex+l],this.qts[this.qtsindex+l]=t,e++}}this.ngroups=e,this.aborted=!1}prune(){let e=this.ntilesCount,s=this.ntilesCount;this.nplays++;do{e=s;for(let i=0;i<this.ngroups;i++){const r=this.qt[i];if(!r.isplayed){const t=r.member[0],l=r.member[1],a=r.member[2],h=r.member[3];switch(r.pairing){case 0:t.isPlayed||l.isPlayed||a.isPlayed?(!t.isPlayed&&n(t)&&(t.isPlayed=!0,e++),!l.isPlayed&&n(l)&&(l.isPlayed=!0,e++),!a.isPlayed&&n(a)&&(a.isPlayed=!0,e++),!h.isPlayed&&n(h)&&(h.isPlayed=!0,e++),t.isPlayed&&l.isPlayed&&a.isPlayed&&h.isPlayed&&(r.isplayed=!0,s-=2)):!t.isPlayed&&n(t)?!l.isPlayed&&n(l)?(t.isPlayed=!0,l.isPlayed=!0,s-=2):!a.isPlayed&&n(a)?(t.isPlayed=!0,a.isPlayed=!0,s-=2):!h.isPlayed&&n(h)&&(t.isPlayed=!0,h.isPlayed=!0,s-=2):!l.isPlayed&&n(l)?!a.isPlayed&&n(a)?(l.isPlayed=!0,a.isPlayed=!0,s-=2):!h.isPlayed&&n(r.member[3])&&(l.isPlayed=!0,h.isPlayed=!0,s-=2):!a.isPlayed&&n(a)&&!h.isPlayed&&n(h)&&(a.isPlayed=!0,h.isPlayed=!0,s-=2);break;case 1:!t.isPlayed&&n(r.member[0])&&n(r.member[1])&&(t.isPlayed=!0,l.isPlayed=!0,s-=2,r.isplayed=a.isPlayed),!a.isPlayed&&n(r.member[2])&&n(r.member[3])&&(a.isPlayed=!0,h.isPlayed=!0,s-=2,r.isplayed=t.isPlayed);break;case 2:!t.isPlayed&&n(t)&&n(a)&&(t.isPlayed=!0,a.isPlayed=!0,s-=2,r.isplayed=l.isPlayed),!l.isPlayed&&n(l)&&n(h)&&(l.isPlayed=!0,h.isPlayed=!0,s-=2,r.isplayed=t.isPlayed);break;case 3:!t.isPlayed&&n(t)&&n(h)&&(t.isPlayed=!0,h.isPlayed=!0,s-=2,r.isplayed=l.isPlayed),!l.isPlayed&&n(l)&&n(a)&&(l.isPlayed=!0,a.isPlayed=!0,s-=2,r.isplayed=t.isPlayed);break;case 4:n(t)&&n(l)&&(t.isPlayed=!0,l.isPlayed=!0,s-=2,r.isplayed=!0);break;case 5:n(r.member[0])&&n(r.member[1])&&n(r.member[2])&&n(r.member[3])&&(t.isPlayed=!0,l.isPlayed=!0,a.isPlayed=!0,h.isPlayed=!0,s-=4,r.isplayed=!0)}}}}while(s!==e);for(let i=0;i<this.ntilesCount;i++)this.tl[i].isPlayed=!1;for(let i=0;i<this.ngroups;i++)this.qt[i].isplayed=!1;return s}unrotateGroups(){for(let e=0;e<this.ngroups;e++){switch(this.qt[e].rotation){case 1:{const s=this.qt[e].member[1];this.qt[e].member[1]=this.qt[e].member[2],this.qt[e].member[2]=this.qt[e].member[3],this.qt[e].member[3]=s;break}case 2:{const s=this.qt[e].member[3];this.qt[e].member[3]=this.qt[e].member[2],this.qt[e].member[2]=this.qt[e].member[1],this.qt[e].member[1]=s;break}}this.qt[e].rotation=0}}sureSolve(e){const s=[];if(this.prune()>this.remainMax)return!1;let i;for(i=e;i<this.ngroups&&(this.qts[i].pairing=1,!(this.prune()>this.remainMax));i++);if(i===this.ngroups){for(let t=0;t<this.ngroups;t++)this.qt[t].bestpairing=this.qt[t].pairing;for(let t=this.qtsindex;t<this.ngroups;t++)this.qts[t].bestpairing+=3-this.qts[t].rotation,this.qts[t].bestpairing>3&&(this.qts[t].bestpairing-=3);if(this.remainMax=this.prune()-2,this.remainMax<this.remainMin){for(let t=this.qtsindex;t<this.ngroups;t++)this.qts[t].pairing=0;return!0}for(i=e;i<this.ngroups;i++)this.qts[i].pairing=0;return this.sureSolve(e)}let r=0;s[r++]=this.qts[i];for(let t=i-1;t>=e;t--)if(this.qts[t].pairing=0,this.prune()<=this.remainMax)this.qts[t].pairing=1,s[r++]=this.qts[t];else{if(m()%2){const l=this.qts[t].member[3];this.qts[t].member[3]=this.qts[t].member[2],this.qts[t].member[2]=this.qts[t].member[1],this.qts[t].member[1]=l,this.qts[t].rotation+=1,this.qts[t].rotation>2&&(this.qts[t].rotation=0)}else{const l=this.qts[t].member[1];this.qts[t].member[1]=this.qts[t].member[2],this.qts[t].member[2]=this.qts[t].member[3],this.qts[t].member[3]=l,this.qts[t].rotation-=1,this.qts[t].rotation<0&&(this.qts[t].rotation=2)}this.qts[i]=this.qts[t],i--}for(let t=i;t>=e;t--)this.qts[t]=s[--r];for(let t=i;t>=e;t--){if(this.qts[t].pairing=2,this.sureSolve(t+1)||(this.qts[t].pairing=3,this.sureSolve(t+1)))return!0;this.qts[t].pairing=0}return!1}randomSolve(e){const s=[],i=[0,0,1,3,6],r=[[0,1,2,3],[1,0,3,2],[2,3,0,1],[3,2,1,0]];for(let t=0;t<e;t++){let l=this.ntilesCount;for(let a=0;a<this.ngroups;a++){s[a]=0;for(let h=0;h<this.qt[a].nmembers;h++)n(this.qt[a].member[h])&&s[a]++;this.qt[a].pairing=-1,2===this.qt[a].nmembers&&(this.qt[a].isplayed=!0)}for(;;){let a=!1,h=0;for(let b=0;b<this.ngroups;b++){if((this.qt[b].isplayed?1:0)+i[s[b]]>=5){a=!0;break}h+=i[s[b]]}if(!a){if(0===h)break;h=m()%h}let d=0;do{h-=i[s[d]],d++}while(h>=0);d--,h+=i[s[d]];let c=0;const g=this.qt[d];let P=g.nmembers-1;if(h<=1){let b=g.member[c];for(;b.isPlayed||!n(b);)c++,b=g.member[c];if(0===h){P=c+1;let x=g.member[P];for(;x.isPlayed||!n(x);)P++,x=g.member[P]}}if(h>=1){let b=g.member[P];for(;b.isPlayed||!n(b);)P--,b=g.member[P];if(2===h){c=P-1;let x=g.member[c];for(;x.isPlayed||!n(x);)c--,x=g.member[c]}}l=u.playTile(g.member[c],s,l),l=u.playTile(g.member[P],s,l),g.isplayed=!0,g.pairing=r[c][P],s[d]-=2}for(let a=0;a<this.ntilesCount;a++)this.tl[a].isPlayed=!1;for(let a=0;a<this.ngroups;a++)this.qt[a].isplayed=!1,2===this.qt[a].nmembers&&(this.qt[a].pairing=4);if(this.nrplays++,l<=this.remainMax){for(let a=0;a<this.ngroups;a++)this.qt[a].bestpairing=this.qt[a].pairing;if(this.remainMax=l-2,this.remainMax<this.remainMin){for(let a=0;a<this.ngroups;a++)4===this.qt[a].nmembers&&(this.qt[a].pairing=0);return!0}}}for(let t=0;t<this.ngroups;t++)4===this.qt[t].nmembers&&(this.qt[t].pairing=0);return!1}solve(e,s){return this.initSolve(),this.nrplays=0,this.nplays=0,this.remainMax=Math.max(e,s),this.remainMin=Math.min(e,s),this.prune()>this.remainMax||this.randomSolve(function y(o){return Math.floor(o)}(Math.pow(1.2,this.ngroups-this.qtsindex)))||(this.sureSolve(this.qtsindex),this.unrotateGroups()),this.remainMax+2}}},50:(w,q,p)=>{p.d(q,{D:()=>m,r:()=>n});class n{constructor(f,u,o,e,s){this.picked=!1,this.group=[],this.z=f,this.x=u,this.y=o,this.v=e,this.groupnr=s}toPosition(){return{z:this.z,x:this.x,y:this.y,v:this.v,groupnr:this.groupnr}}isBlocked(){return n.hasStone(this.nodes.top)||n.hasStone(this.nodes.left)&&n.hasStone(this.nodes.right)}static hasStone(f){for(const u of f)if(!u.picked)return!0;return!1}}const m=(y,f,u,o)=>{for(let e=0,s=y.length;e<s;e++)if(y[e].z===f&&y[e].x===u&&y[e].y===o)return y[e]}}}]);